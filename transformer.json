{
    "version": "1.0",
    "description": "Mapping for dataset Estados Financieros of institutions supervised by 'Superintendencia Financiera' of Colombia",
    "elements-iterator-jsonpath": "$.[0:][0:]",
    "field-mappings": [
        {
            "field-name": "TIPO_IDENTIFICACION",
            "description": "Identification type. For this dataset, it is always '2' (NIT)",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "2",
                "default-value": null
            }
        },
        {
            "field-name": "_TIPO_ENTIDAD",
            "description": "Internal use only. Entity type. It is used to build the URL to get the identification number.",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "@jsonpath($.tipo_entidad)",
                "default-value": null
            }
        },
        {
            "field-name": "IDENTIFICACION",
            "description": "Identification number with Verification Digit. It is obtained from the datos.gov.co dataset in JSON. The URL to load the data is built with the entity type (_TIPO_ENTIDAD) and this entity code",
            "optional": false,
            "transformation": {
                "type": "cache",
                "value": {
                    "value-to-find": ["@jsonpath($.codigo_entidad)", "@local(_TIPO_ENTIDAD)"],
                    "cache-definition": {
                        "namespace": "cache_ns",
                        "source": "cache/sr9n-792w.json",
                        "source-type": "json",
                        "strategy": "full",
                        "keys": ["@cache_ns.jsonpath($.cod_entidad)", "@cache_ns.jsonpath($.tipo_entidad)"],
                        "value": "@cache_ns.python(custom_function.slice_string(@cache_ns.jsonpath($.numeroidentificacion), 0, 9))"
                    }
                },
                "default-value": null,
                "exception-strategy": "ignore"
            }
        },
        {
            "field-name": "RAZON",
            "description": "Legal Name of the entity",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "@jsonpath($.nombre_entidad)",
                "default-value": null
            }
        },
        {
            "field-name": "CODIGO_CUENTA",
            "description": "Account code",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "@jsonpath($.nombre_cuenta)",
                "default-value": null
            }
        },
        {
            "field-name": "DESCRIPCION_CUENTA",
            "description": "Account description",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "@jsonpath($.cuenta)",
                "default-value": null
            }
        },
        {
            "field-name": "VALOR",
            "description": "Total Amount for the account in COP",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "@jsonpath($.valor)",
                "default-value": null
            }
        },
        {
            "field-name": "NIIF",
            "description": "International Financial Reporting Standards flag. It is always 'TRUE' for this dataset",
            "optional": false,
            "transformation": {
                "type": "simple",
                "value": "TRUE",
                "default-value": null
            }
        },
        {
            "field-name": "FECHA_FINANZAS",
            "description": "Cut-off date of the dataset. It is obtained from the dataset in JSON and transformed to the format 'MM/DD/YYYY'.",
            "optional": false,
            "transformation": {
                "type": "regex",
                "value": {
                    "element": "@jsonpath($.fecha_corte)",
                    "pattern": "(\\d{4})-(\\d{2})-(\\d{2})T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}",
                    "replacement": "\\2/\\3/\\1"
                },
                "default-value": null
            }
        }
    ]
}
